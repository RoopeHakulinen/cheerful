<div
  [style.background-color]="carpet.color"
  [style.height]="(carpet.height * tileDimension) + 'px'"
  [style.width]="(carpet.width * tileDimension) + 'px'"
  class="carpet">
  <div class="grid">
    <div class="lines vertical">
      <div *ngFor="let _ of verticalSegments" class="line"></div>
    </div>
    <!--    <div class="lines horizontal">-->
    <!--      <div *ngFor="let _ of horizontalSegments" class="line"></div>-->
    <!--    </div>-->
    <div
      [style.height]="(carpet.height * tileDimension) + 'px'"
      cdkDropListGroup
      class="tile-container">
      <div
        (cdkDropListDropped)="swapPositions(index)"
        (click)="active.emit(item)"
        *ngFor="let item of subframe.grid.slice(0, carpet.height*carpet.width); index as index"
        [@animate]="{value: animate, params: getAnimationParams(item, index)}"
        [attr.index]="index"
        [class.active]="activeItem && activeItem === item"
        [style.flex]="'0 1 ' + tileDimension + 'px'"
        [style.height]="tileDimension + 'px'"
        [style.width]="tileDimension + 'px'"
        cdkDropList
        class="tile">
        <div (cdkDragStarted)="dragStarted(index)" cdkDrag class="drag-container">
          <div *cdkDragPreview></div>
          <div
            *ngIf="isPerson(item.content)"
            [style.background]="(item.content.personId | choreographyPerson:choreography.id | async)?.color ?? 'transparent'"
            class="text-container {{item.shape}} {{item.position}}">
            {{(item.content.personId | person).name}}
          </div>
          <div
            *ngIf="(isTwoGroup(item.content) || isThreeGroup(item.content)
            || isFourGroup(item.content) || isFiveGroup(item.content)) && item.content.flyerId !== null"
            [style.background]="item.content.color ?? (item.content.flyerId !== null ? (item.content.flyerId | choreographyPerson:choreography.id | async)?.color : 'transparent')"
            class="text-container {{item.shape}} grid-bottom flyer">
            {{(item.content.flyerId | person).name}}
          </div>
          <div
            *ngIf="(isTwoGroup(item.content) || isThreeGroup(item.content)
            || isFourGroup(item.content) || isFiveGroup(item.content)) && item.content.backspotId !== null"
            [style.background]="item.content.color ?? (item.content.backspotId !== null ? (item.content.backspotId | choreographyPerson:choreography.id | async)?.color : 'transparent')"
            class="text-container {{item.shape}} grid-top">
            {{(item.content.backspotId | person).name}}
          </div>
          <div
            *ngIf="(isThreeGroup(item.content)  || isFourGroup(item.content) || isFiveGroup(item.content)) && item.content.mainbaseId !== null"
            [style.background]="item.content.color ?? (item.content.mainbaseId !== null ? (item.content.mainbaseId | choreographyPerson:choreography.id | async)?.color : 'transparent')"
            class="text-container {{item.shape}} grid-left">
            {{(item.content.mainbaseId | person).name}}
          </div>
          <div *ngIf="(isFourGroup(item.content) || isFiveGroup(item.content)) && item.content.sidebaseId !== null"
               [style.background]="item.content.color ?? (item.content.sidebaseId !== null ? (item.content.sidebaseId | choreographyPerson:choreography.id | async)?.color : 'transparent')"
               class="text-container {{item.shape}} grid-right">
            {{(item.content.sidebaseId | person).name}}
          </div>
          <div *ngIf="isFiveGroup(item.content) && item.content.frontspotId !== null"
               [style.background]="item.content.color ?? (item.content.frontspotId !== null ? (item.content.frontspotId | choreographyPerson:choreography.id | async)?.color : 'transparent')"
               class="text-container {{item.shape}} grid-middle">
            {{(item.content.frontspotId | person).name}}
          </div>
        </div>
      </div>
      <div [style.width]="tileDimension * carpet.width + 'px'" class="audience-container"
           translate="CARPET.AUDIENCE"></div>
      <div (cdkDropListDropped)="removeDraggedPerson()"
           [style.flex]="'0 1 ' + tileDimension + 'px'"
           [style.height]="tileDimension + 'px'"
           [style.width]="tileDimension + 'px'"
           cdkDropList
           class="tile trash-can-container">
        <span *ngIf="isDeletable" cdkDrag> 🗑️ </span>
      </div>
    </div>
  </div>
</div>
