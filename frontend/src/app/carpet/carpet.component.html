<div class="container">
  <div class="carpet-container">
    <div class="lines vertical">
      <div *ngFor="let _ of verticalSegments" class="line"></div>
    </div>
    <div class="lines horizontal">
      <div *ngFor="let _ of horizontalSegments" class="line"></div>
    </div>
    <div
      [style.background-color]="carpet.color"
      cdkDropListGroup
      [style.grid-template-columns]="'repeat(' + carpet.width + ', 1fr)'"
      [style.grid-template-rows]="'repeat(' + carpet.height + ', 1fr)'"
      class="carpet">
      <div
        *ngFor="let item of frameToShow.grid.slice(0, carpet.height*carpet.width); index as index"
        (cdkDropListDropped)="swapPositions(index)"
        (click)="active.emit(item)"
        [@animate]="{value: animate, params: getAnimationParams(item, index)}"
        [attr.index]="index"
        [class.active]="activeItem && activeItem === item"
        cdkDropList
        #tile
        class="tile">
        <div (cdkDragStarted)="dragStarted(index)" cdkDrag
             class="drag-container {{item.position}} {{item.content?.type}}">
          <div *cdkDragPreview></div>
          <div
            *ngIf="isPerson(item.content)"
            [style.background]="(item.content.personId | choreographyPerson:choreography)?.color"
            class="text-container {{item.shape}} {{item.position}} single-person">
            {{(item.content.personId | person).name}}
          </div>
          <div
            *ngIf="(isTwoGroup(item.content) || isThreeGroup(item.content)
            || isFourGroup(item.content) || isFiveGroup(item.content)) && item.content.flyerId !== null"
            [style.background]="item.content.color ?? (item.content.flyerId !== null ? (item.content.flyerId | choreographyPerson:choreography)?.color : 'transparent')"
            class="text-container {{item.shape}} flyer {{isFiveGroup(item.content) ? 'center' : 'grid-bottom'}}">
            {{(item.content.flyerId | person).name}}
          </div>
          <div
            *ngIf="(isTwoGroup(item.content) || isThreeGroup(item.content)
            || isFourGroup(item.content) || isFiveGroup(item.content)) && item.content.backspotId !== null"
            [style.background]="item.content.color ?? (item.content.backspotId !== null ? (item.content.backspotId | choreographyPerson:choreography)?.color : 'transparent')"
            class="text-container {{item.shape}} grid-top">
            {{(item.content.backspotId | person).name}}
          </div>
          <div
            *ngIf="(isThreeGroup(item.content)  || isFourGroup(item.content) || isFiveGroup(item.content)) && item.content.mainbaseId !== null"
            [style.background]="item.content.color ?? (item.content.mainbaseId !== null ? (item.content.mainbaseId | choreographyPerson:choreography)?.color : 'transparent')"
            class="text-container {{item.shape}} grid-left">
            {{(item.content.mainbaseId | person).name}}
          </div>
          <div *ngIf="(isFourGroup(item.content) || isFiveGroup(item.content)) && item.content.sidebaseId !== null"
               [style.background]="item.content.color ?? (item.content.sidebaseId !== null ? (item.content.sidebaseId | choreographyPerson:choreography)?.color : 'transparent')"
               class="text-container {{item.shape}} grid-right">
            {{(item.content.sidebaseId | person).name}}
          </div>
          <div *ngIf="isFiveGroup(item.content) && item.content.frontspotId !== null"
               [style.background]="item.content.color ?? (item.content.frontspotId !== null ? (item.content.frontspotId | choreographyPerson:choreography)?.color : 'transparent')"
               class="text-container {{item.shape}} grid-bottom">
            {{(item.content.frontspotId | person).name}}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
