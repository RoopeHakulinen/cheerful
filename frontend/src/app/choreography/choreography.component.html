<div *ngIf="choreography">
  <app-toolbar (click)="logGridToConsole()" [title]="choreography.name" backUrl="/choreographies"></app-toolbar>
  <div fxLayout="column" fxLayout.gt-sm="row">
    <div class="padding" fxFlex.gt-sm="300px" fxFlexOrder.lt-md="3">
      <app-frame-manager
        (addContentFrame)="addContentFrame($event)"
        (addTransitionFrame)="addTransitionFrame()"
        (changeActiveFrame)="changeActiveFrame($event)"
        (changeCarpetHeight)="changeCarpetHeight($event)"
        (changeCarpetWidth)="changeCarpetWidth($event)"
        (changeHorizontalSegments)="changeCarpetHorizontalSegments($event)"
        (changeVerticalSegments)="changeCarpetVerticalSegments($event)"
        (frameDurationChange)="frameDurationChange($event)"
        (pauseFrames)="pause()"
        (playFrames)="play()"
        (remove)="removeFrame($event)"
        (switchFramePosition)="switchFramePosition($event)"
        (toggleAnimations)="toggleAnimations()"
        (toggleLooping)="toggleLooping()"
        (toggleVoiceSynthesis)="toggleVoiceSynthesis()"
        (changeFrameToPreviousFrame)="copyFrameFromPreviousFrame()"
        (changeFramePosition)="moveFrameUpOrDown($event)"
        [activeFrameIndex]="activeFrameIndex"
        [frames]="choreography.frames"
        [areAnimationsOn]="areAnimationsOn"
        [carpetHeight]="choreography.carpet.height"
        [carpetHorizontalSegments]="choreography.carpet.horizontalSegments"
        [carpetVerticalSegments]="choreography.carpet.verticalSegments"
        [carpetWidth]="choreography.carpet.width"
        [frameInterval]="frameInterval"
        [isPlaying]="playFrameIntervalId !== null"
        [isLoopingOn]="isLoopingOn"
        [tempo]="tempo"
        [isVoiceSynthesisOn]="isVoiceSynthesisOn"></app-frame-manager>
      <app-people
        (add)="addPerson($event)"
        (remove)="removePerson($event)"
        [people]="choreography.people"></app-people>
      <div class="save-div">
        <button
          (click)="saveChoreography()"
          [matTooltip]="'FRAME_MANAGER.SAVE_TO_STORAGE_TOOLTIP' | translate"
          mat-raised-button>
          <mat-icon>save</mat-icon>
        </button>
        <button
          (click)="loadChoreography()"
          [disabled]="localStorageEmpty"
          [matTooltip]="'FRAME_MANAGER.LOAD_FROM_STORAGE_TOOLTIP' | translate"
          mat-raised-button>
          <mat-icon>restore</mat-icon>
        </button>
        <button (click)="exportAsJson()"
                class="single-button"
                [matTooltip]="'FRAME_MANAGER.SAVE_TO_FILE_TOOLTIP' | translate"
                mat-raised-button>
          <mat-icon>file_download</mat-icon>
        </button>
        <input #fileUpload (change)="onFileSelected($event)"
               class="file-input" type="file">
        <button (click)="fileUpload.click()" class="upload-file single-button"
                [matTooltip]="'FRAME_MANAGER.LOAD_FROM_FILE_TOOLTIP' | translate"
                mat-raised-button>
          <mat-icon>file_upload</mat-icon>
        </button>
      </div>
    </div>
    <div fxFlex="grow">
      <app-carpet
        (active)="setActiveChoreographyItem($event)"
        (removePerson)="removePersonFromCarpet($event)"
        (swap)="swapItems($event)"
        [people]="allAvailablePeople"
        [activeItem]="activeChoreographyItem"
        [animationDuration]="frameInterval / tempo"
        [areAnimationsOn]="areAnimationsOn"
        [choreography]="choreography"
        [carpet]="choreography.carpet"
        [frame]="activeFrame"
        [nextFrame]="choreography.frames[(activeFrameIndex + 1) % choreography.frames.length]"></app-carpet>
      <div class="frame-options-container">
        <div class="frame-options-settings">
          <div class="name">
            <mat-form-field appearance="fill" class="name">
              <mat-label translate="COMMON.NAME"></mat-label>
              <input (ngModelChange)="changeFrameName($event)"
                     [ngModel]="choreography.frames[activeFrameIndex].name"
                     [disabled]="choreography.frames[activeFrameIndex].type !== 'content'" matInput/>
            </mat-form-field>
          </div>
          <div class="duration">
            <mat-form-field appearance="fill" class="duration">
              <mat-label translate="COMMON.DURATION"></mat-label>
              <input (ngModelChange)="changeFrameDuration($event)"
                     [ngModel]="choreography.frames[activeFrameIndex].duration"
                     matInput type="number"/>
            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="notes">
        <button
          (click)="areNotesShown = !areNotesShown"
          mat-stroked-button
          translate="CHOREOGRAPHY.NOTES"></button>
        <div class="notes-input">
          <mat-form-field *ngIf="areNotesShown" appearance="fill" class="notes-text">
            <mat-label translate="CHOREOGRAPHY.NOTES_HINT"></mat-label>
            <textarea [(ngModel)]="choreography.frames[activeFrameIndex].notes" cdkTextareaAutosize
                      matInput></textarea>
          </mat-form-field>
        </div>
      </div>
      <app-eight-counter
        [activeFrame]="actualActiveFrameIndex"
        [duration]="frameInterval"
        [isPlayingOn]="playFrameIntervalId !== null"
        [isSpeechSynthesisOn]="isVoiceSynthesisOn"
        [tempo]="tempo"></app-eight-counter>
    </div>
    <div class="tile-options" fxFlex.gt-sm="400px">
      <div *ngIf="activeChoreographyItem" class="edit-item padding">
        <div>
          <div class="tile-options-buttons">
            <button
              (click)="activeChoreographyItem = null"
              mat-raised-button
              translate="COMMON.CLOSE"></button>
            <button
              (click)="clearItem(activeChoreographyItem)"
              [disabled]="activeChoreographyItem.content === null"
              mat-raised-button
              translate="COMMON.REMOVE"></button>
            <button
              (click)="toggleBetweenGroupAndSingleMode()"
              mat-raised-button>
              {{(isGroup(activeChoreographyItem.content) ? 'CHOREOGRAPHY.EXIT_GROUP' : 'CHOREOGRAPHY.CREATE_GROUP') | translate}}
            </button>
          </div>
          <div fxLayout="row">
            <div fxLayout="row" fxLayoutWrap="wrap">
              <div *ngIf="isPerson(activeChoreographyItem.content) || activeChoreographyItem.content === null" fxFlex>
                <mat-form-field>
                  <mat-select
                    (valueChange)="changePersonOnCarpet($event)"
                    [placeholder]="'CHOREOGRAPHY.CHANGE_PERSON' | translate"
                    [value]="activeChoreographyItem.content?.personId ?? ''">
                    <mat-option
                      *ngFor="let person of choreography.people"
                      [value]="person.personId">{{(person.personId | person).name}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div *ngIf="isGroup(activeChoreographyItem.content)" fxFlex>
                <mat-form-field>
                  <mat-select
                    (valueChange)="switchGroupType($event)"
                    [placeholder]="'CHOREOGRAPHY.GROUP_TYPE' | translate"
                    [value]="activeChoreographyItem.content?.type ?? ''">
                    <mat-option
                      *ngFor="let groupType of availableGroupTypes"
                      [value]="groupType">{{'CHOREOGRAPHY.GROUP_TYPE_NAMES.' + (groupType | uppercase) | translate}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field>
                  <mat-select (valueChange)="changeGroupColor($event)" [placeholder]="'COMMON.COLOR' | translate">
                    <mat-option translate="COMMON.BLACK" value="black"></mat-option>
                    <mat-option translate="COMMON.RED" value="red"></mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
            <div fxFlex="column">
              <div *ngIf="isGroup(activeChoreographyItem.content)" class="group-participants-container">
                <app-two-group *ngIf="isTwoGroup(activeChoreographyItem.content)"
                               (changePersonInGroup)="changePersonOnGroup($event)"
                               [group]="activeChoreographyItem.content"
                               [people]="choreography.people"></app-two-group>
                <app-three-group *ngIf="isThreeGroup(activeChoreographyItem.content)"
                                 (changePersonInGroup)="changePersonOnGroup($event)"
                                 [group]="activeChoreographyItem.content"
                                 [people]="choreography.people"></app-three-group>
                <app-four-group *ngIf="isFourGroup(activeChoreographyItem.content)"
                                (changePersonInGroup)="changePersonOnGroup($event)"
                                [group]="activeChoreographyItem.content"
                                [people]="choreography.people"></app-four-group>
                <app-five-group *ngIf="isFiveGroup(activeChoreographyItem.content)"
                                (changePersonInGroup)="changePersonOnGroup($event)"
                                [group]="activeChoreographyItem.content"
                                [people]="choreography.people"></app-five-group>
              </div>
            </div>
          </div>
        </div>
        <div class="position-selector">
          <div
            (click)="setPositionForItem(activeChoreographyItem, position)"
            *ngFor="let position of positionOptions"
            [class.active]="activeChoreographyItem.position === position"
            class="option">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
